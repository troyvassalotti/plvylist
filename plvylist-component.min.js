export class Plvylist extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.createIcon=this.createIcon.bind(this),this.createSlider=this.createSlider.bind(this),this.icons={play:'<title>Play</title><path d="M7 4v16l13 -8z"/>',pause:'<title>Pause</title><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="6" y="5" width="4" height="14" rx="1" /><rect x="14" y="5" width="4" height="14" rx="1" />',previous:'<title>Previous</title><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M21 5v14l-8 -7z"></path><path d="M10 5v14l-8 -7z"></path>',next:'<title>Next</title><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M3 5v14l8-7z"></path><path d="M14 5v14l8-7z"></path>',shuffle:'<title>Shuffle</title><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><rect x="3" y="3" width="6" height="6" rx="1"></rect><rect x="15" y="15" width="6" height="6" rx="1"></rect><path d="M21 11v-3a2 2 0 0 0 -2 -2h-6l3 3m0 -6l-3 3"></path><path d="M3 13v3a2 2 0 0 0 2 2h6l-3 -3m0 6l3 -3"></path>',loop:'<title>Loop</title><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M4 12v-3a3 3 0 0 1 3 -3h13m-3 -3l3 3l-3 3"></path><path d="M20 12v3a3 3 0 0 1 -3 3h-13m3 3l-3-3l3-3"></path><path d="M11 11l1 -1v4"></path>',volOff:'<title>Volume</title><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 15h-2a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h2l3.5 -4.5a.8 .8 0 0 1 1.5 .5v14a.8 .8 0 0 1 -1.5 .5l-3.5 -4.5" /><path d="M16 10l4 4m0 -4l-4 4" />',volLow:'<title>Volume</title><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 8a5 5 0 0 1 0 8" /><path d="M6 15h-2a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h2l3.5 -4.5a.8 .8 0 0 1 1.5 .5v14a.8 .8 0 0 1 -1.5 .5l-3.5 -4.5" />',volMid:'<title>Volume</title><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 8a5 5 0 0 1 0 8" /><path d="M17.7 5a9 9 0 0 1 0 14" /><path d="M6 15h-2a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h2l3.5 -4.5a.8 .8 0 0 1 1.5 .5v14a.8 .8 0 0 1 -1.5 .5l-3.5 -4.5" />'},this.placeholder="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJDYXBhXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA2MCA2MCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNjAgNjA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj48Zz48cGF0aCBkPSJNMzAsMEMxMy40NTgsMCwwLDEzLjQ1OCwwLDMwczEzLjQ1OCwzMCwzMCwzMHMzMC0xMy40NTgsMzAtMzBTNDYuNTQyLDAsMzAsMHogTTMwLDU4QzE0LjU2MSw1OCwyLDQ1LjQzOSwyLDMwUzE0LjU2MSwyLDMwLDJzMjgsMTIuNTYxLDI4LDI4UzQ1LjQzOSw1OCwzMCw1OHoiLz48cGF0aCBkPSJNMjMuMTY1LDguNDU5YzAuNTM3LTAuMTMsMC44NjgtMC42NywwLjczOS0xLjIwNmMtMC4xMjktMC41MzctMC42Ny0wLjg2Ni0xLjIwNi0wLjczOWMtMy45MzUsMC45NDYtNy41MjIsMi45NTUtMTAuMzc2LDUuODA5UzcuNDYsMTguNzY0LDYuNTE0LDIyLjY5OGMtMC4xMjksMC41MzYsMC4yMDIsMS4wNzYsMC43MzksMS4yMDZjMC4wNzgsMC4wMTksMC4xNTcsMC4wMjcsMC4yMzQsMC4wMjdjMC40NTEsMCwwLjg2MS0wLjMwOCwwLjk3Mi0wLjc2N2MwLjg1OS0zLjU3NSwyLjY4NS02LjgzNiw1LjI3Ny05LjQyOVMxOS41OSw5LjMxOCwyMy4xNjUsOC40NTl6Ii8+PHBhdGggZD0iTTUyLjc0NywzNi4wOTZjLTAuNTM4LTAuMTI5LTEuMDc3LDAuMjAxLTEuMjA2LDAuNzM5Yy0wLjg1OSwzLjU3NS0yLjY4NSw2LjgzNi01LjI3Nyw5LjQyOXMtNS44NTQsNC40MTgtOS40Myw1LjI3N2MtMC41MzcsMC4xMy0wLjg2OCwwLjY3LTAuNzM5LDEuMjA2YzAuMTEsMC40NTksMC41MjEsMC43NjcsMC45NzIsMC43NjdjMC4wNzcsMCwwLjE1Ni0wLjAwOSwwLjIzNC0wLjAyN2MzLjkzNi0wLjk0Niw3LjUyMy0yLjk1NSwxMC4zNzctNS44MDlzNC44NjItNi40NDEsNS44MDktMTAuMzc2QzUzLjYxNSwzNi43NjYsNTMuMjg0LDM2LjIyNiw1Mi43NDcsMzYuMDk2eiIvPjxwYXRoIGQ9Ik0yNC40NTIsMTMuMjg2YzAuNTM4LTAuMTI1LDAuODczLTAuNjYzLDAuNzQ3LTEuMmMtMC4xMjUtMC41MzgtMC42NjUtMC44NzgtMS4yLTAuNzQ3Yy0zLjA5LDAuNzItNS45MDQsMi4yODItOC4xNDEsNC41MmMtMi4yMzcsMi4yMzYtMy44LDUuMDUxLTQuNTIsOC4xNDFjLTAuMTI2LDAuNTM3LDAuMjA5LDEuMDc1LDAuNzQ3LDEuMmMwLjA3NiwwLjAxOSwwLjE1MiwwLjAyNiwwLjIyOCwwLjAyNmMwLjQ1NCwwLDAuODY1LTAuMzEyLDAuOTczLTAuNzczYzAuNjM1LTIuNzI1LDIuMDE0LTUuMjA3LDMuOTg2LTcuMThTMjEuNzI4LDEzLjkyMSwyNC40NTIsMTMuMjg2eiIvPjxwYXRoIGQ9Ik00OC42NjEsMzYuMDAxYzAuMTI2LTAuNTM3LTAuMjA5LTEuMDc1LTAuNzQ3LTEuMmMtMC41MzgtMC4xMzMtMS4wNzUsMC4yMDktMS4yLDAuNzQ3Yy0wLjYzNSwyLjcyNS0yLjAxNCw1LjIwNy0zLjk4Niw3LjE4cy00LjQ1NSwzLjM1Mi03LjE4LDMuOTg2Yy0wLjUzOCwwLjEyNS0wLjg3MywwLjY2My0wLjc0NywxLjJjMC4xMDcsMC40NjIsMC41MTksMC43NzMsMC45NzMsMC43NzNjMC4wNzUsMCwwLjE1MS0wLjAwOCwwLjIyOC0wLjAyNmMzLjA5LTAuNzIsNS45MDQtMi4yODIsOC4xNDEtNC41MkM0Ni4zNzksNDEuOTA1LDQ3Ljk0MSwzOS4wOTEsNDguNjYxLDM2LjAwMXoiLz48cGF0aCBkPSJNMjYuNDk1LDE2LjkyNWMtMC4xMTktMC41NDEtMC42NTMtMC44NzktMS4xOS0wLjc2M2MtNC41NTcsMC45OTctOC4xNDYsNC41ODYtOS4xNDMsOS4xNDNjLTAuMTE4LDAuNTM5LDAuMjI0LDEuMDcyLDAuNzYzLDEuMTljMC4wNzIsMC4wMTYsMC4xNDQsMC4wMjMsMC4yMTUsMC4wMjNjMC40NiwwLDAuODczLTAuMzE4LDAuOTc2LTAuNzg2YzAuODMxLTMuNzk2LDMuODIxLTYuNzg2LDcuNjE3LTcuNjE3QzI2LjI3MSwxNy45OTcsMjYuNjEzLDE3LjQ2NCwyNi40OTUsMTYuOTI1eiIvPjxwYXRoIGQ9Ik00My44MzgsMzQuNjk1YzAuMTE4LTAuNTM5LTAuMjI0LTEuMDcyLTAuNzYzLTEuMTljLTAuNTQtMC4xMTgtMS4wNzIsMC4yMjItMS4xOSwwLjc2M2MtMC44MzEsMy43OTYtMy44MjEsNi43ODYtNy42MTcsNy42MTdjLTAuNTM5LDAuMTE4LTAuODgxLDAuNjUxLTAuNzYzLDEuMTljMC4xMDMsMC40NjgsMC41MTYsMC43ODYsMC45NzYsMC43ODZjMC4wNzEsMCwwLjE0My0wLjAwOCwwLjIxNS0wLjAyM0MzOS4yNTIsNDIuODQxLDQyLjg0MSwzOS4yNTIsNDMuODM4LDM0LjY5NXoiLz48cGF0aCBkPSJNMzguMDgsMzBjMC00LjQ1NS0zLjYyNS04LjA4LTguMDgtOC4wOHMtOC4wOCwzLjYyNS04LjA4LDguMDhzMy42MjUsOC4wOCw4LjA4LDguMDhTMzguMDgsMzQuNDU1LDM4LjA4LDMweiBNMzAsMzYuMDhjLTMuMzUzLDAtNi4wOC0yLjcyOC02LjA4LTYuMDhzMi43MjgtNi4wOCw2LjA4LTYuMDhzNi4wOCwyLjcyOCw2LjA4LDYuMDhTMzMuMzUzLDM2LjA4LDMwLDM2LjA4eiIvPjwvZz48L3N2Zz4=",this.styles='\n    <style>\n      * {\n        margin: 0;\n      }\n      \n      .plvylist {\n        accent-color: var(--plvylist-accent, royalblue);\n        font-family: var(--plvylist-font, inherit);\n        line-height: var(--plvlist-line-height, 1.5);\n        margin-inline: auto;\n      }\n      \n      #artwork {\n        block-size: auto;\n        max-inline-size: 100%;\n      }\n      \n      .meta {\n        align-items: flex-end;\n        display: flex;\n        flex-wrap: wrap;\n        gap: 1em;\n      }\n      \n      #next {\n        margin-inline-end: auto;\n      }\n      \n      .loop--active svg {\n        stroke: var(--plvylist-changed, crimson);\n      }\n      \n      .seeker {\n        margin-block: 1rem;\n      }\n      \n      .volume {\n        display: inline-flex;\n      }\n      \n      :is(.controls, .song) button {\n        background: none;\n        border: none;\n        color: inherit;\n        cursor: pointer;\n        font: inherit;\n        stroke: currentColor;\n      }\n      \n      .controls {\n        align-items: center;\n        display: flex;\n        flex-wrap: wrap;\n        justify-content: center;\n        margin-block: 1rem;\n      }\n      \n      .controls button:hover svg {\n        opacity: .666;\n      }\n      \n      .controls__primary {\n        display: flex;\n        flex: 1;\n        inline-size: 100%;\n        justify-content: center;\n      }\n      \n      .song__title {\n        text-align: inherit;\n        transition: .1s color ease-in-out;\n      }\n      \n      .song__active button,\n      .song__title:hover {\n        opacity: .666;\n        text-decoration: underline;\n      }\n      \n      input[type=range] {\n        inline-size: 100%;\n      }\n      \n      img[src^="data:image/svg+xml"] {\n        filter: contrast(.5)\n      }\n    </style>\n        ',this.container=`\n      <div class="plvylist">\n        <audio id="plvylist"></audio>\n        <section class="meta">\n          <img src="${this.placeholder}" alt="album artwork" id="artwork" width="300" height="300" loading="lazy" decoding="async">\n          <div class="track-info">\n            <p class="artist">--</p>\n            <p class="track">--</p>\n            <p class="album">--</p>\n            <p class="timer"><span class="currentTime">--</span> / <span class="duration">--</span></p>\n          </div>\n        </section>\n        <section class="seeker"></section>\n        <section class="controls">\n          <div class="controls__primary"></div>\n          <div class="controls__secondary">\n            <div class="volume"></div>\n          </div>\n        </section>\n        <section class="tracklist">\n          <ol id="songs"></ol>\n        </section>\n      </div>\n      `}get tracksLocation(){return this.getAttribute("tracks")}get startingVolume(){return this.getAttribute("starting-volume")}get startingTime(){return this.getAttribute("starting-time")}createIcon(t,e,n=""){const i=document.createElement("button");i.id=t;const s=document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.setAttribute("viewBox","0 0 24 24"),s.setAttribute("stroke-width","1.5"),s.setAttribute("stroke-linecap","round"),s.setAttribute("stroke-linejoin","round"),s.setAttribute("fill","none"),"large"===n)s.setAttribute("width","34"),s.setAttribute("height","34");else s.setAttribute("width","24"),s.setAttribute("height","24");return s.innerHTML=e,i.appendChild(s),i}createSlider(t,e={}){const n=document.createElement("input");n.id=t,n.type="range";for(const t in e)n.setAttribute(t,e[t]);return n}connectedCallback(){const{shadowRoot:t}=this;t.innerHTML=`\n        ${this.styles}\n        ${this.container}\n        `;const e=t.querySelector(".controls__primary");e.appendChild(this.createIcon("previous",this.icons.previous)),e.appendChild(this.createIcon("action",this.icons.play,"large")),e.appendChild(this.createIcon("next",this.icons.next)),e.appendChild(this.createIcon("shuffle",this.icons.shuffle)),e.appendChild(this.createIcon("loop",this.icons.loop));t.querySelector(".seeker").appendChild(this.createSlider("seeker",{min:"0",step:"0.01",value:"0","aria-label":"seek through the track"}));const n=t.querySelector(".volume");n.appendChild(this.createIcon("volumeBtn",this.icons.volMid)),n.appendChild(this.createSlider("volume",{min:"0",max:"1",step:"0.01","aria-label":"volume control"}));let i,s=!1;const M=this.icons.play,l=this.icons.pause,r=this.icons.volMid,o=this.icons.volOff,a=this.icons.volLow,u=this.placeholder,c=this.tracksLocation,L=t.querySelector("#plvylist"),d=t.querySelector("#artwork"),N=t.querySelector(".artist"),h=t.querySelector(".track"),w=t.querySelector(".album"),j=t.querySelector(".currentTime"),y=t.querySelector(".duration"),z=t.querySelector("#seeker"),p=t.querySelector("#previous"),T=t.querySelector("#action"),v=t.querySelector("#next"),C=t.querySelector("#shuffle"),g=t.querySelector("#loop"),D=t.querySelector("#volumeBtn"),A=t.querySelector("#volume"),m=t.querySelector("#songs");A.value=this.startingVolume||.5,L.volume=this.startingVolume||.5,z.value=this.startingTime||0,L.currentTime=this.startingTime||0,async function(){await fetch(c).then((t=>t.json())).then((e=>{let n=[],c=e.tracks,S=c.length;const I="--";function O(t){z.value=0,L.currentTime=0,L.src=c[t].file,i=t,N.innerHTML=c[t].artist||I,h.innerHTML=c[t].title||I,w.innerHTML=c[t].album||I,d.setAttribute("src",c[t].artwork||u),Y()}function k(){let e="";c.forEach(((t,n)=>{e+=`<li data-track="${n}" data-file="${t.file}" class="song"><button class="song__title">${t.title}</button></li>`})),m.innerHTML=e,n=t.querySelectorAll(".song__title"),n.forEach(((t,e)=>t.addEventListener("click",(()=>{void 0===i?(O(e),E()):L.paused?O(e):(O(e),L.play())}))))}function x(){L.pause(),T.querySelector("svg").innerHTML=M,s=!s}function E(){L.play(),T.querySelector("svg").innerHTML=l,s=!s}function f(){void 0===i?O(0):i+1<S?L.paused?O(i+1):(O(i+1),L.play()):(x(),O(0),s=!1)}function Y(t=L.currentTime){if(""===L.src)return!1;let e=Math.floor(t/60);e<10&&(e=`0${e}`);let n=Math.floor(t%60);n<10&&(n=`0${n}`),j.innerHTML=`${e}:${n}`}function b(){0===L.volume||L.muted?D.querySelector("svg").innerHTML=o:L.volume<=.45?D.querySelector("svg").innerHTML=a:D.querySelector("svg").innerHTML=r}L.addEventListener("loadstart",(()=>{t.querySelector(`[data-file="${c[i].file}"]`).classList.add("song__active")})),L.addEventListener("loadedmetadata",(function(){let t=L.duration,e=Math.floor(t/60);e<10&&(e=`0${e}`);let n=Math.floor(t%60);n<10&&(n=`0${n}`),y.innerHTML=`${e}:${n}`})),L.addEventListener("volumechange",b),L.addEventListener("ended",(()=>{L.loop||(i===S-1?f():(f(),L.play()))})),L.addEventListener("timeupdate",(()=>{z.value=`${parseInt(L.currentTime/L.duration*100,10)}`,Y()})),L.addEventListener("emptied",(()=>{t.querySelector(".song__active").classList.remove("song__active")})),z.addEventListener("change",(()=>{if(void 0===i)return!1;L.currentTime=z.value*L.duration/100,s&&L.play()})),z.addEventListener("input",(t=>{if(void 0===i)return!1;L.pause(),Y(t.target.value*L.duration/100)})),p.addEventListener("click",(function(){if(void 0===i)return!1;i-1>-1?L.paused?O(i-1):(O(i-1),L.play()):(x(),O(i),s=!1)})),T.addEventListener("click",(()=>{void 0===i?(O(0),E()):L.paused?E():x()})),v.addEventListener("click",f),g.addEventListener("click",(function(){L.loop=!L.loop,g.classList.toggle("loop--active")})),C.addEventListener("click",(()=>{window.alert("This will stop your current track and start you over fresh, okay?"),function(){for(let t=c.length-1;t>0;t--){let e=Math.floor(Math.random()*(t+1)),n=c[t];c[t]=c[e],c[e]=n}}(),k(),L.paused?O(0):(O(0),L.play())})),D.addEventListener("click",(function(){L.muted?(L.muted=!L.muted,b(),A.value=L.volume):(L.muted=!L.muted,D.querySelector("svg").innerHTML=o,A.value=0)})),A.addEventListener("input",(t=>{L.volume=A.value}),!1),k()}))}()}}customElements.define("plvylist-player",Plvylist);